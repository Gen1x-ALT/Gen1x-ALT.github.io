<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta http-equiv="Content-Language" content="en-us">
      <title>Guestbook</title>
      <link rel="stylesheet" href="styles.css">
      <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.4/purify.min.js"></script>
      <style>
        form {
            text-align: left;
        }

        form label {
            font-weight: bold;
        }
        
        textarea {
            width: 30%;
            padding: 8px;
            margin: 8px 0;
            box-sizing: border-box;
        }

        input[type="submit"] {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        input[type="submit"]:hover {
            background-color: #45a049;
        }

        hr {
            border: 1px solid #ddd;
        }

        #commentsContainer, #commentstitle {
            text-align: left;
            padding: 10px;
        }

        small {
            color: #b5b5b5;
        }
      </style>
   </head>
   <body>
      <table border="0" cellpadding="0" cellspacing="0" width="100%" height="141">
         <tr class="header">
            <td align="center" height="124">
               <img border="0" src="images/cool_guestbook.png" width="739" height="124">
            </td>
         </tr>
      </table>
      <br>
      <table border="0" cellpadding="0" cellspacing="0" width="100%" bordercolorlight="#FFFFFF" bordercolordark="#000000">
         <tr>
            <td valign="top" width="217" style="border: none; font-weight: normal;" id="sidebar">
               <span style="letter-spacing: 0px">
                  <!--webbot bot="Navigation" s-orientation="vertical" s-rendering="graphics" s-type="top" b-include-home="TRUE" b-include-up="TRUE" startspan --><nobr><a href="index.htm" target="">Home</a></nobr><br> <nobr><a href="projects.htm" target="">Projects&nbsp;and&nbsp;stuff</a></nobr><br> <nobr>Guestbook</nobr><!--webbot bot="Navigation" i-checksum="1519" endspan --></span><b>
                  </b>
               <p>
                  <b>
                     <object classid="clsid:D27CDB6E-AE6D-11CF-96B8-444553540000" id="intro" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" border="0" width="217" height="217" title="A cool test animation I made to try out Adobe Flash CS3 Professional :)">
                        <param name="movie" value="flash/intro.swf">
                        <param name="quality" value="High">
                        <param name="loop" value="false">
                        <param name="play" value="false">
                        <embed src="https://gen1x.is-a.dev/flash/intro.swf" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" name="intro" width="217" height="217" quality="High" loop="false" play="false">
                     </object>
                  </b>
               </p>
            </td>
            <td valign="top" width="94%" height="100%" style="border: solid; border-size: 2px;" id="me">
               <center>
                  
                  <h3><font size="5">Cool guestbook </font>
					<img border="0" src="images/new.gif" width="40" height="30"></h3>
                  
                  <!--webbot BOT="GeneratedScript" PREVIEW=" " startspan --><script Language="JavaScript" Type="text/javascript"><!--
function FrontPage_Form1_Validator(theForm)
{

  if (theForm.username.value == "")
  {
    alert("Please enter a value for the \"username\" field.");
    theForm.username.focus();
    return (false);
  }

  if (theForm.username.value.length > 8)
  {
    alert("Please enter at most 8 characters in the \"username\" field.");
    theForm.username.focus();
    return (false);
  }

  if (theForm.comment.value == "")
  {
    alert("Please enter a value for the \"comment\" field.");
    theForm.comment.focus();
    return (false);
  }

  if (theForm.comment.value.length > 150)
  {
    alert("Please enter at most 150 characters in the \"comment\" field.");
    theForm.comment.focus();
    return (false);
  }
  return (true);
}
//--></script><!--webbot BOT="GeneratedScript" endspan --><form method="POST" action="https://corsproxy.org/?https%3A%2F%2Fmany-things.hstn.me%2Fgbook%2Fnew_entry.php" onsubmit="return FrontPage_Form1_Validator(this)" language="JavaScript" name="FrontPage_Form1">
                     <label for="username">Username:</label>
                     <p>
                        &nbsp;<!--webbot bot="Validation" b-value-required="TRUE" i-maximum-length="8" --><input type="text" id="username" name="username" required size="25" maxlength="8"><br><br>
                        <label for="comment">Comment:</label> 
                     </p>
                     <p>
                        &nbsp;<!--webbot bot="Validation" b-value-required="TRUE" i-maximum-length="150" --><textarea id="comment" name="comment" required rows="8" cols="28"></textarea><br><br>
                        <input type="submit" value="Submit">
                     </p>
                  </form>
                  <hr>
                  <h3 id="commentstitle"><u><font size="5">Comments:</font></u></h3>
                  <div id="commentsContainer"><img src="images/loading.gif"></div>
                  <hr>
                  <p>Pages</p>
                  <div id="pages"></div>
               </center>
            </td>
         </tr>
      </table>
      <p class="center-align">
         <i>
            <small>
               This site was last updated
               <!--webbot bot="Timestamp" s-type="EDITED" s-format="%d-%b-%Y %H:%M:%S" startspan -->12-mar.-2024 13:03:05<!--webbot bot="Timestamp" i-checksum="30249" endspan -->
            </small>
         </i>
      </p>
      <script>
        // Fetch data from the JSON file
    const currentPage = new URLSearchParams(window.location.search).get('page') || 1;

    fetch(`https://corsproxy.org/?https%3A%2F%2Fmany-things.hstn.me%2Fgbook%2Fentries.php%3Fpage%3D=${currentPage}`)
        .then(response => response.json())
        .then(data => {
            // Display comments in a div
            const commentsContainer = document.getElementById('commentsContainer');
            const pagesContainer = document.getElementById('pages');

            data = data.comments;
            const maxPages = data.maxPages || 1;

            // Sort comments by timestamp in descending order
            data.sort((a, b) => b.timestamp - a.timestamp);
            
            commentsContainer.innerHTML = "";

            data.forEach(comment => {
                // Convert timestamp to local time
                const timestamp = new Date(comment.timestamp * 1000);
                const localTime = timestamp.toLocaleString();

                const commentDiv = document.createElement('div');
                commentDiv.id = "id-" + comment.id;
                // Sanitize comment content using DOMPurify
                const sanitizedComment = DOMPurify.sanitize(comment.comment);
                const sanitizedUsername = DOMPurify.sanitize(comment.username);
                const sanitizedId = DOMPurify.sanitize(comment.id.toString());
                if (!sanitizedComment || !sanitizedUsername || !sanitizedId) {
                    return;
                }   
                commentDiv.innerHTML = `
                    <p><i>ID: ${sanitizedId}</i></p><p><strong>${sanitizedUsername}:</strong> ${sanitizedComment}</p>
                    <p><small>${localTime}</small></p><br>
                `;
                commentsContainer.appendChild(commentDiv);
            });

            // Add basic pages navigation
            for (let i = 1; i <= maxPages; i++) {
                const pageLink = document.createElement('a');
                pageLink.href = `?page=${i}`;
                pageLink.innerText = i;
                if (i == currentPage) {
                    pageLink.style.fontWeight = 'bold';
                }
                pagesContainer.appendChild(pageLink);

                if (i < maxPages) {
                    pagesContainer.appendChild(document.createTextNode(' | '));
                }
            }

            // Check if "id" parameter is present in the URL
            const urlParams = new URLSearchParams(window.location.search);
            const commentId = urlParams.get('id');
            if (commentId) {
                const targetComment = document.getElementById('id-' + commentId);
                if (targetComment) {
                    // Scroll to the specified comment
                    targetComment.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        })
        .catch(error => console.error('Error fetching data:', error));
      </script>
   </body>
</html>